## CONTROL DE CALIDAD ##
import pandas as pd
import os

# Ruta del archivo Excel original
ruta_archivo = r'D:\Mis documentos\Documentos\MAESTRIA\TFM\convert.xlsx'

# Leer archivo
df = pd.read_excel(ruta_archivo)
print("Archivo cargado. Filas totales:", len(df))

# Filtrar por tipos de plástico
plastics_of_interest = ['PET', 'PE', 'PVC', 'PP']
df_filtered = df[df['Plastic'].isin(plastics_of_interest)]
print("Filas tras filtrar por plástico:", len(df_filtered))

# Eliminar duplicados (Microorganismo + Plástico)
df_filtered = df_filtered.drop_duplicates(subset=['Microorganism'])
print("Filas después de eliminar duplicados:", len(df_filtered))

# Clasificar microorganismos por grupo taxonómico (evita warning)
df_filtered.loc[:, 'Group'] = df_filtered['lineage'].apply(
    lambda x: 'Fungi' if 'Fungi' in str(x) else ('Bacteria' if 'Bacteria' in str(x) else 'Other')
)
print("Vista previa con clasificación taxonómica:")
print(df_filtered[['Microorganism', 'Plastic', 'lineage', 'Group']].head())

# Guardar archivo filtrado
ruta_guardado = r'D:\Mis documentos\Documentos\MAESTRIA\TFM\dataset_filtrado.xlsx'
df_filtered.to_excel(ruta_guardado, index=False)
print(f"Archivo guardado en: {ruta_guardado}")
